"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _crypto=_interopRequireDefault(require("crypto")),_axios=_interopRequireDefault(require("axios")),_createFile=_interopRequireDefault(require("./create-file"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}class CacheFile{constructor(a,b){_defineProperty(this,"_path",void 0),_defineProperty(this,"_type",""),_defineProperty(this,"_axiosClient",void 0),_defineProperty(this,"_cache",void 0),_defineProperty(this,"_hash",""),_defineProperty(this,"_guid",""),_defineProperty(this,"_cacheId",""),_defineProperty(this,"_isCached",!1),this._cache=a,this.hash=b,this.checkCache(),this._axiosClient=_axios.default.create({method:"GET",responseType:"arraybuffer"})}async getPath(a,b,c){if(this._path)return{path:this._path,hash:this._hash};if(!this._isCached)return this.downloadFile(b).then(async b=>{const d=await this.createFile(b.data,a,c);return await this.setCache(d),this._path=d,{path:d,hash:this._hash}});const d=await this.fetchCache();return{path:d,hash:this._guid}}async createFile(a,b,c){return(0,_createFile.default)(a,b,c,this._guid)}async downloadFile(a){return await this._axiosClient.get(a)}set hash(a){this._hash=a,this._guid=this.generateGUID(),this._cacheId=`google-maps-static-cache-${this._guid}`}async checkCache(){const a=await this._cache.get(this._cacheId);this._isCached=!!a,a&&(this._path=a)}async setCache(a){return await this._cache.set(this._cacheId,a)}async fetchCache(){return this._cache.get(this._cacheId)}generateGUID(){return _crypto.default.createHash("sha256").update(this._hash).digest("hex")}}var _default=CacheFile;exports.default=_default;