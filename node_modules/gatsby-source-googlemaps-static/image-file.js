"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _queryString=_interopRequireDefault(require("query-string")),_cacheFile=_interopRequireDefault(require("./cache-file")),_googleSignUrl=_interopRequireDefault(require("./google-sign-url"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}class ImageFile extends _cacheFile.default{constructor(a,b){super(a,_queryString.default.stringify(b)),_defineProperty(this,"baseURL","https://maps.googleapis.com/maps/api/staticmap"),_defineProperty(this,"_params",void 0),_defineProperty(this,"_extension",".png"),_defineProperty(this,"_useSignature",!1),_defineProperty(this,"_useClient",!1),this._useSignature=b.hasSecret,delete b.hasSecret;let c="";b.markers&&(c+=this.parseArrayParams(b.markers,"markers"),delete b.markers),b.visible&&(c&&(c+="&"),c+=this.parseArrayParams(b.visible,"visible"),delete b.visible),b.style&&(c&&(c+="&"),c+=this.parseArrayParams(b.style,"style"),delete b.style),b.path&&(c&&(c+="&"),c+=this.parseArrayParams(b.path,"path"),delete b.path),this._params=this.generateParams(b,"",c),this._extension=`.${b.format}`,this._useClient=!!b.client}async getHref(a,b,c){return await this.getPath(a,this.getUrl(b,c),this._extension)}getUrl(a,b){let c=`${this.baseURL}?${this._params}`;return c=this._useClient?this.generateParams({client:a},c):this.generateParams({key:a},c),this._useSignature?this.generateSignature(c,b):c}generateSignature(a,b){return(0,_googleSignUrl.default)(a,b)}generateParams(a,b="",c=""){let d="",e="";return"string"==typeof b?d=b:b.forEach(a=>{d+=`&${a}`}),"string"==typeof c?e=c:c.forEach(a=>{e+=`&${a}`}),(d?d+"&":"")+_queryString.default.stringify(a)+(e?"&"+e:"")}parseArrayParams(a,b){if("string"==typeof a)return`${b}=${a}`;let c="";return a.forEach((d,e)=>{c+=`${b}=${d}`,e!==a.length-1&&(c+="&")}),c}}var _default=ImageFile;exports.default=_default;