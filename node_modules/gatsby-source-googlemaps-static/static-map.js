"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _imageFile=_interopRequireDefault(require("./image-file")),_marker=_interopRequireDefault(require("./marker")),_style=_interopRequireDefault(require("./style")),_path=_interopRequireDefault(require("./path"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}class StaticMap{constructor(a,b,c){_defineProperty(this,"_file",void 0),_defineProperty(this,"_url",void 0),_defineProperty(this,"_query",void 0),_defineProperty(this,"_store",void 0),_defineProperty(this,"_options",{}),_defineProperty(this,"_isImplicit",!1),this._store=c,this._url="",this.options=a,this._isImplicit=this.isImplicit(),this.file=b,this._query=a.query,this.generateMapUrl()}async getFilePath(a,b){var c;const d=this._options.client?this._options.client:a,{path:e,hash:f}=(await(null===(c=this._file)||void 0===c?void 0:c.getHref(this._store,d,b)))||{path:"",hash:""};return{absolutePath:e,center:this._isImplicit?"Implicit Map":this._options.center,hash:f}}get url(){return this._url}isImplicit(){return!this._options.center&&(!!this._options.markers||!!this._options.paths)||!!this._options.visible}set file(a){this._file=new _imageFile.default(a,this.getJSON())}set options(a){this._options={},this._options.size=a.size?a.size.includes("x")?a.size:`${a.size}x${a.size}`:"640x640",this._options.markers=this.parseOption(a.markers,"Marker")||"",this._options.paths=this.parseOption(a.paths,"Path")||"",this._options.styles=this.parseOption(a.styles,"Style")||"",this._options.visible=this.parseOption(a.visible||"")||"",this._options.hasSecret=!!a.secret,this._options.zoom=a.zoom||"14",this._options.format=a.format||"png",this._options.center=a.center||"",this._options.client=a.clientID,this._options.scale=a.scale,this._options.mapType=a.mapType}getJSON(){const a={center:this._options.center,client:this._options.client||"",format:this._options.format,hasSecret:this._options.hasSecret||!1,maptype:this._options.mapType,markers:this.mapArray(this._options.markers)||[],path:this.mapArray(this._options.paths)||[],scale:this._options.scale,size:this._options.size,style:this.mapArray(this._options.styles)||[],visible:this.mapArray(this._options.visible)||[],zoom:this._options.zoom};return this._isImplicit&&delete a.zoom,a}parseOption(a,b){if(a&&(a instanceof Array||"string"==typeof a)){if("string"==typeof a)return a;let c=[];return a.forEach(a=>{"string"==typeof a?c=[...c,a]:"Path"===b?c=[...c,new _path.default(a)]:"Marker"===b?c=[...c,new _marker.default(a)]:"Style"===b?c=[...c,new _style.default(a)]:void 0}),c||""}return""}mapArray(a){return"string"==typeof a?a:a.map(a=>"string"==typeof a?encodeURIComponent(a):a.urlParams)}generateMapUrl(){let a="https://www.google.com/maps/";a=this._isImplicit?`${a}dir/?api=1&${this.parseWayPoints()}`:this.isCords()?`${a}@?api=1&map_action=map&center=${encodeURIComponent(this._options.center)}`:`${a}search/?api=1&query=${encodeURIComponent(this._query||this._options.center)}`,this._url=a}isCords(){return!this._query&&RegExp(/^[^a-zA-Z]+$/).test(this._options.center)}parseWayPoints(){if(this._options.paths){var a;return"string"==typeof this._options.paths[0]?this._options.paths[0]:null===(a=this._options.paths[0])||void 0===a?void 0:a.wayPoints}const b=this.getWayPoints();let c="",d="",e="";return 1===b.length?"string"==typeof b[0]?`origin=${b[0]}&destination=${b[0]}`:`origin=${b[0].wayPoint}&destination=${b[0].wayPoint}`:2===b.length?"string"==typeof b[0]||"string"==typeof b[1]?`origin=${b[0]}&destination=${b[1]}`:`origin=${b[0].wayPoint}&destination=${b[1].wayPoint}`:(b.forEach((a,f)=>{0===f?c=encodeURIComponent("string"==typeof a?a:a.wayPoint):f===b.length-1?d=encodeURIComponent("string"==typeof a?a:a.wayPoint):e+=`${encodeURIComponent("|")}${encodeURIComponent("string"==typeof a?a:a.wayPoint)}`}),`origin=${c}&destination=${d}&waypoints=${e}`)}getWayPoints(){return this._options.markers?[...this._options.markers]:this._options.visible?[...this._options.visible]:[]}}var _default=StaticMap;exports.default=_default;